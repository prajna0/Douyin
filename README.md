# 抖音无水印视频解析API使用指南

## 关于项目来源
本API基于开源项目 [JiJiang778/Shortvideo-parsing](https://github.com/JiJiang778/Shortvideo-parsing) 开发，感谢原作者的开源贡献。原项目包含抖音、小红书、快手等多平台的短视频解析工具，本指南聚焦于抖音无水印视频解析功能的使用说明。


## 功能说明
该API基于**TikHub开放接口**开发，可解析抖音分享链接，自动调用2个核心接口完成数据获取：
1. [抖音高清视频播放地址接口](https://docs.tikhub.io/312096106e0)（获取无水印视频链接及分辨率/帧率信息）
2. [抖音视频统计数据接口](https://docs.tikhub.io/186826221e0)（获取播放量、点赞数、评论数等互动数据）

最终返回多清晰度无水印视频地址、视频元数据（帧率/分辨率）及完整统计信息，支持直接用于视频下载或播放。


## 准备工作
### 1. 获取TikHub API密钥
1. 访问 [TikHub官网](https://tikhub.io) 注册并登录账号
2. 进入**控制台** → **API密钥管理**，创建并复制你的API密钥（需确保账号已开通上述2个接口的调用权限）
3. （可选）在TikHub控制台查看接口调用额度、限流规则及数据返回格式（参考接口文档链接）

### 2. 环境要求
- 服务器需支持 **PHP 7.0+**
- 已安装并启用 **CURL扩展**（用于发起HTTP请求）
- 缓存目录需具备**写入权限**（默认路径为代码同级的`cache`文件夹）


## 配置步骤
1. 下载并解压代码包，找到核心文件 `dyyy.php`
2. 打开文件，定位到**顶部配置区**，替换以下参数（仅需修改这3项，核心代码无需改动）：
   ```php
   <?php
   // ======================
   // 配置区 - 请替换为你的信息
   // ======================
   $TIKHUB_API_KEY = '你的TikHub API密钥'; // 必改：替换为从TikHub获取的密钥
   $CACHE_DIR = __DIR__ . '/cache';       // 可选：缓存文件存储目录（默认即可）
   $CACHE_EXPIRE_TIME = 60;             // 可选：缓存有效期（秒），默1分钟（减少接口调用次数）
   ```
3. 保存文件，将代码部署到你的PHP服务器（如Apache、Nginx）


## 使用方法
### 1. 发起请求
通过 **HTTP GET请求** 调用API，仅需传入抖音分享链接作为`url`参数，示例：
```
# 格式
http://你的服务器域名/dyyy.php?url=抖音分享链接

# 实际示例
http://example.com/dyyy.php?url=https://v.douyin.com/iJdX78k/
```

### 2. 抖音分享链接获取方式
1. 打开抖音APP，找到目标视频
2. 点击视频右侧「分享」按钮
3. 选择「复制链接」，即可获取用于解析的分享链接


## 响应说明
API返回 **JSON格式** 数据，结构清晰，便于开发调用，示例响应如下：
```json
{
  "code": 200,
  "msg": "解析成功",
  "data": {
    "aweme_id": "7309445163833773364", // 视频唯一ID（来自TikHub接口）
    "fps": "30",                       // 视频帧率（来自高清视频接口）
    "width": 1080,                     // 视频宽度（来自高清视频接口）
    "height": 1920,                    // 视频高度（来自高清视频接口）
    "play_count": "5.88亿",            // 格式化后的播放量（原始数据来自统计接口）
    "digg_count": 22870578,            // 点赞数（来自统计接口）
    "comment_count": 1271483,          // 评论数（来自统计接口）
    "share_count": 3832096,            // 分享数（来自统计接口）
    "download_count": 0,               // 下载数（来自统计接口）
    "video_list": [                    // 多清晰度视频地址列表（来自高清视频接口）
      {"url": "javascript:void(0)", "level": "免责声明: 下载的视频仅供个人学习"},
      {"url": "https://v26.douyinvod.com/xxx.mp4", "level": "[原画]-[30FPS]-[1080×1920]-[12.3MB]"},
      {"url": "https://v26.douyinvod.com/xxx.mp4", "level": "[1080P]-[30FPS]-[9.8MB]"}
    ]
  }
}
```

### 状态码说明
| 状态码 | 含义                     | 解决方案                                  |
|--------|--------------------------|-------------------------------------------|
| 200    | 解析成功                 | 正常使用`data`中的视频数据                |
| 201    | 未能提取视频ID/页面解析失败 | 检查抖音分享链接是否有效，或稍后重试      |
| 400    | 缺少`url`参数            | 请求时必须携带`?url=抖音分享链接`参数     |


## 核心接口依赖说明
代码自动调用以下2个TikHub接口，无需手动配置接口地址：
| 接口名称                 | TikHub文档链接                | 作用                                  |
|--------------------------|-------------------------------|---------------------------------------|
| 高清视频播放地址接口     | https://docs.tikhub.io/312096106e0 | 获取无水印视频链接、分辨率、帧率、文件大小 |
| 视频统计数据接口         | https://docs.tikhub.io/186826221e0 | 获取播放量、点赞数、评论数等互动数据    |


## 注意事项
1. **API密钥安全**：密钥是调用TikHub接口的凭证，请勿公开代码或在前端页面直接引用，避免密钥泄露导致额度被盗用。
2. **接口调用限制**：
   - 参考 [TikHub接口文档](https://docs.tikhub.io) 查看具体接口的QPS（每秒调用次数）限制
   - 代码默认启用缓存（1分钟），可通过`$CACHE_EXPIRE_TIME`调整，减少重复调用，避免限流
3. **权限问题**：若解析失败，检查TikHub账号是否已开通上述2个接口的调用权限（未开通会返回403/401错误）。
4. **合规性**：解析的视频仅用于个人学习，未经作者授权不得用于商业用途或非法传播，遵守抖音平台规则及相关法律法规。
5. **缓存权限**：确保`$CACHE_DIR`目录（默认`cache`文件夹）有写入权限，否则缓存无法生效，会增加接口调用次数。
